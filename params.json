{"name":"Fribera.github.io","tagline":"mapas con la API de cartodb","body":"+\t<! (c) Francisco Ribera Ruiz 2014 -->\r\n+\t<html>\r\n+\t<head>\r\n+\t  <link rel=\"stylesheet\" href=\"http://libs.cartocdn.com/cartodb.js/v3/themes/css/cartodb.css\" />\r\n+\t  <!--[if lte IE 8]>\r\n+\t    <link rel=\"stylesheet\" href=\"http://libs.cartocdn.com/cartodb.js/v3/themes/css/cartodb.ie.css\" />\r\n+\t  <![endif]-->\r\n+\t  <script src=\"http://libs.cartocdn.com/cartodb.js/v3/cartodb.js\"></script>\r\n+\t  <style>\r\n+\t    html, body {width:100%; height:100%; padding: 0; margin: 0;}\r\n+\t    #map { width:100%; height:100%; background: black;}\r\n+\t    #menu { position: absolute; top: 5px; left: 50px; width: 800px; height:60px; background: transparent; z-index:10;}\r\n+\t    #menu a { \r\n+\t      margin: 10px 10px 0 0;\r\n+\t      float: right;\r\n+\t      vertical-align: baseline;\r\n+\t      width: 80px;\r\n+\t      padding: 10px;\r\n+\t      text-align: center;\r\n+\t      font: bold 11px \"Helvetica\",Arial;\r\n+\t      line-height: normal;\r\n+\t      color: #555;\r\n+\t      border-radius: 4px;\r\n+\t      border: 1px solid #777777;\r\n+\t      background: #ffffff;\r\n+\t      text-decoration: none;\r\n+\t      cursor: pointer;\r\n+\t    }\r\n+\t    #menu a.selected,\r\n+\t    #menu a:hover { \r\n+\t      color: #F84F40;\r\n+\t    }\r\n+\t    #combo {background-color:white;bottom:35px;cursor:pointer;padding:15px;position:absolute;left:15px;z-index:1;\">\r\n+\t       \r\n+\t  </style>\r\n+\t\r\n+\t  <script>\r\n+\t  var sublayers = [];\r\n+\t  var total = 0;\r\n+\t  var Opciones = {};\r\n+\t  var antiguedad = \"\";\r\n+\t  var sxxi = \"\";\r\n+\t  var sxx = \"\";\r\n+\t  var sxix = \"\";\r\n+\t  var older = \"\";\r\n+\t  var marcados = 0;\r\n+\t  \tOpciones.app = {\r\n+\t\t   \r\n+\t\t   updateSiglo: function(el) {\r\n+\t\t    marcados = 0;\r\n+\t\t    \r\n+\t\t    sxxi = \"\";\r\n+\t\t    x = document.getElementById(\"S.XXI\").checked;\r\n+\t\t    if (x === true) \r\n+\t\t    {\r\n+\t\t    sxxi = sxxi + \"  ano_construccion between 2001 and 2012  \";\r\n+\t\t    marcados = marcados +1\r\n+\t\t    }  else sxxi = \"\"\r\n+\t\t    \r\n+\t\t    sxx = \"\";\r\n+\t\t    x = document.getElementById(\"S.XX\").checked;\r\n+\t\t    if (x === true) \r\n+\t\t    {  \r\n+\t\t    if (marcados > 0) sxx = \" or \";\r\n+\t\t    sxx = sxx + \" ano_construccion between 1901 and 2000  \";\r\n+\t\t    marcados = marcados +1;\r\n+\t\t    }  else sxx = \"\";\r\n+\t\t    \r\n+\t\t    sxix = \"\";\r\n+\t\t    x = document.getElementById(\"S.XIX\").checked;\r\n+\t\t    if (x === true) \r\n+\t\t    {\r\n+\t\t    if (marcados > 0) sxix = \" or \";\r\n+\t\t    sxix = sxix + \" ano_construccion between 1801 and 1900  \";\r\n+\t\t    marcados = marcados +1;\r\n+\t\t    }  else sxix = \"\";\r\n+\t\t   \r\n+\t\t    older = \"\";\r\n+\t\t    x = document.getElementById(\"older\").checked;\r\n+\t\t    if (x === true) \r\n+\t\t    { \r\n+\t\t    if (marcados > 0) older = \" or \";\r\n+\t\t    older = older + \" ano_construccion < 1801\";\r\n+\t\t    marcados = marcados +1;\r\n+\t\t    }  else older = \"\";\r\n+\t\t    \r\n+\t\t    if (marcados > 0)\r\n+\t\t    {\r\n+\t\t    antiguedad = \"and (\" +sxxi +sxx +sxix +older +\")\";\r\n+\t\t    } else antiguedad = \"and ano_construccion < 0\";\r\n+\t\t    Opciones.app.updateQuery();\r\n+\t\t   },\r\n+\t\t   \r\n+\t\t   updateQuery: function() {\r\n+\t\t   \t \r\n+\t\t  \t   \t \r\n+\t\t   \tif (total == 0) \r\n+\t\t\t{\r\n+\t\t\t  sublayers[0].set({\r\n+\t\t\t\tsql: \"SELECT * FROM bcn_construcciones_parcelas where district = '1'\" +antiguedad\r\n+\t\t\t  });\r\n+\t\t\t}  \r\n+\t\t\telse \r\n+\t\t\t{\r\n+\t\t\t  sublayers[0].set({\r\n+\t\t\t\tsql: \"SELECT * FROM bcn_construcciones_parcelas where district = '1' and  cbarri ='\"+total+\"'\" +antiguedad\r\n+\t\t\t  });\r\n+\t\t\t}\r\n+\t\t   }\r\n+\t    }\r\n+\t  \r\n+\t  var map;\r\n+\t  function init(){\r\n+\t    // initiate leaflet map\r\n+\t    map = new L.Map('map', { \r\n+\t      center: [41.384,2.18],\r\n+\t      zoom: 15\r\n+\t    })\r\n+\t\r\n+\t    L.tileLayer('https://dnv9my2eseobd.cloudfront.net/v3/cartodb.map-4xtxp73f/{z}/{x}/{y}.png', {\r\n+\t      attribution: 'Mapbox <a href=\"http://mapbox.com/about/maps\" target=\"_blank\">Terms &amp; Feedback</a>'\r\n+\t    }).addTo(map);\r\n+\t    // crear capa\r\n+\t      var layerUrl = 'http://fribera.cartodb.com/api/v2/viz/6e00fadc-adea-11e3-9ea7-0edbca4b5057/viz.json';\r\n+\t     \r\n+\t      cartodb.createLayer(map, layerUrl)\r\n+\t      .addTo(map)\r\n+\t      .on('done', function(layer) {\r\n+\t\t\t\t\r\n+\t\t\t\t var sublayer = layer.getSubLayer(0);\r\n+\t\t\t\t \r\n+\t\t\t\t sublayers.push(sublayer);\r\n+\t      $('.button').click(function() {\r\n+\t        $('.button').removeClass('selected'); $(this).addClass('selected');\r\n+\t        total = $(this).attr('id');\r\n+\t        Opciones.app.updateQuery();\r\n+\t      })\r\n+\t\t  }).on('error', function() {\r\n+\t      //log the error\r\n+\t      });\r\n+\t  }\r\n+\t  </script>\r\n+\t</head>\r\n+\t\r\n+\t<body onload=\"init()\">\r\n+\t  <div id='map'></div>\r\n+\t  // menu de barrios\r\n+\t  <div id='menu'>\r\n+\t    <a href=\"#4\" id=\"4\" value=4 class=\"button 4\">Santa Caterina</a> \r\n+\t    <a href=\"#3\" id=\"3\" value=3 class=\"button 3\">Barceloneta</a> \r\n+\t    <a href=\"#2\" id=\"2\" value=2 class=\"button 2\">Gotic</a> \r\n+\t    <a href=\"#1\" id=\"1\" value=1 class=\"button 1\">El Raval</a> \r\n+\t    <a href=\"#0\" id=\"0\" value=0 class=\"button 0 selected\">Ciutat Vella</a> \r\n+\t  </div>\r\n+\t  // combo de seleccion de siglos\r\n+\t  <div id='combo'>\r\n+\t  <table>\r\n+\t\t<tr><td>\r\n+\t\t    <input type=\"checkbox\" id=\"S.XXI\" onclick=\"Opciones.app.updateSiglo(this)\" checked>\r\n+\t\t    </td>\r\n+\t\t\t<td>\r\n+\t\t\t<label for=\"S.XXI\" style=\"color:#000;line-height:18px;width:auto;\">S.XXI</label>\r\n+\t\t\t</td>\r\n+\t\t</tr>\r\n+\t\t<tr><td>\r\n+\t\t\t<input type=\"checkbox\" id=\"S.XX\" onclick=\"Opciones.app.updateSiglo(this)\" checked>\r\n+\t\t\t</td>\r\n+\t\t\t<td><label for=\"S.XX\" style=\"color:#000;line-height:18px;width:auto;\">S.XX</label>\r\n+\t\t\t</td>\r\n+\t\t</tr>\r\n+\t\t<tr><td><input type=\"checkbox\" id=\"S.XIX\" onclick=\"Opciones.app.updateSiglo(this)\" checked>\r\n+\t\t\t</td>\r\n+\t\t\t<td><label for=\"S.XIX\" style=\"color:#000;line-height:18px;width:auto;\">S.XIX</label>\r\n+\t\t\t</td>\r\n+\t\t</tr>\r\n+\t\t<tr><td><input type=\"checkbox\" id=\"older\" onclick=\"Opciones.app.updateSiglo(this)\" checked>\r\n+\t\t\t</td>\r\n+\t\t\t<td><label for=\"older\" style=\"color:#000;line-height:18px;width:auto;\">older</label>\r\n+\t\t\t</td>\r\n+\t\t</tr>\r\n+\t   </table>\r\n+\t</div> \r\n+\t</body>\r\n+\t</html>\r\n \t\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}